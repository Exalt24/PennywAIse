{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="PennywAIse Dashboard" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/main/output.css' %}" />
    <link rel="stylesheet" href="{% static 'css/budget/dashboard.css' %}" />
  </head>
  <body class="flex h-screen overflow-hidden bg-[#f5f1ed] text-[#333]">
    
    <aside class="sidebar">
      <h1 class="logo">PennywAIse</h1>
      <button id="addEntryBtn" class="create">+ Add Entry</button>
      <nav>
        <a href="#dashboard" class="active">Dashboard</a>
        <a href="#income">Income</a>
        <a href="#expenses">Expenses</a>
        <a href="#categories">Categories</a>
        <a href="#reports">Reports</a>
      </nav>
    </aside>

    
    <main class="main">
      <header class="user">
        <div class="relative">
          <button id="userBtn" class="button">
            <span>Hello, Jane Doe</span>
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path
                d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.06z"
              />
            </svg>
          </button>
          <div id="userMenu" class="hidden usermenu">
            <a href="#" class="menu">Profile</a>
            <a href="#" class="menu">Settings</a>
            <div class="border-t my-1"></div>
            <a href="#" class="menu">Logout</a>
          </div>
        </div>
      </header>
      
      <section id="dashboard" class="page-content">
        <header>
          <h2 class="pagetitle">Dashboard</h2>
          <div class="search">
            <input type="text" placeholder="Search expenses…" />
          </div>
        </header>
        
        <section id="overview" class="overview">
          <article class="card">
            <h3 class="title">Total Income</h3>
            <p class="value">$5,200.00</p>
            <p class="meta">This month</p>
          </article>
          <article class="card">
            <h3 class="title">Total Expenses</h3>
            <p class="value">$3,450.00</p>
            <p class="meta">This month</p>
          </article>
          <article class="card">
            <h3 class="title">Net Balance</h3>
            <p class="value">$1,750.00</p>
            <p class="meta">Income − Expenses</p>
          </article>
          <article class="card">
            <h3 class="title">Transactions</h3>
            <p class="value">18</p>
            <p class="meta">Entries this month</p>
          </article>
        </section>

        
        <section id="charts" class="content">
          <div class="progress flex-1 bg-white rounded-lg p-4 shadow-md">
            <h2>Monthly Trend</h2>
            <canvas id="trendChart" width="300" height="200"></canvas>
          </div>
          <div class="progress flex-1 bg-white rounded-lg p-4 shadow-md">
            <h2>Expenses by Category</h2>
            <canvas id="categoryChart" width="300" height="200"></canvas>
          </div>
        </section>

        
        <section id="recent" class="project-summary overflow-hidden">
          <h2>Recent Transactions</h2>

          
          <div class="overflow-x-auto">
            <table class="table-auto w-full">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Title</th>
                  <th>Category</th>
                  <th>Amount</th>
                  <th>Type</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Apr 25, 2025</td>
                  <td>Salary</td>
                  <td>Income</td>
                  <td>$3,000.00</td>
                  <td>Income</td>
                  <td class="whitespace-nowrap">
                    <div class="inline-flex items-center space-x-1">
                      <a href="#">Edit</a>
                      <span>|</span>
                      <a href="#">Delete</a>
                    </div>
                  </td>
                </tr>
                <tr>
                  
                  <td>Apr 25, 2025</td>
                  <td>Salary</td>
                  <td>Income</td>
                  <td>$3,000.00</td>
                  <td>Income</td>
                  <td class="whitespace-nowrap">
                    <div class="inline-flex items-center space-x-1">
                      <a href="#">Edit</a>
                      <span>|</span>
                      <a href="#">Delete</a>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>Apr 25, 2025</td>
                  <td>Salary</td>
                  <td>Income</td>
                  <td>$3,000.00</td>
                  <td>Income</td>
                  <td class="whitespace-nowrap">
                    <div class="inline-flex items-center space-x-1">
                      <a href="#">Edit</a>
                      <span>|</span>
                      <a href="#">Delete</a>
                    </div>
                  </td>
                </tr>
                
              </tbody>
            </table>
          </div>
        </section>

        
        <section
          id="actions"
          class="bottom grid grid-cols-1 md:grid-cols-2 gap-8"
        >
          <div class="tasks">
            <h2>Quick Actions</h2>
            <ul>
              <li><a href="#">Add Income</a></li>
              <li><a href="#">Add Expense</a></li>
              <li><a href="#">View Full Reports</a></li>
            </ul>
          </div>
          <div class="workload">
            <h2>Category Summary</h2>
            <ul class="list-none">
              <li>Food: $600.00</li>
              <li>Bills: $400.00</li>
              <li>Transport: $200.00</li>
              <li>Entertainment: $150.00</li>
              <li>Others: $100.00</li>
            </ul>
          </div>
        </section>
      </section>

      
      <section id="income" class="page-content hidden">
        <header class="flex justify-between items-center mb-5">
          <h2 class="text-2xl font-bold">Income</h2>
          <div class="search">
            <input
              type="text"
              placeholder="Search income…"
              id="incomeSearch"
              class="w-full sm:w-72 px-4 py-2 border border-gray-300 rounded-lg"
            />
          </div>
        </header>
      
        <div class="overflow-x-auto bg-white rounded-lg shadow-md">
          <table class="table-auto w-full">
            <thead class="bg-gray-100">
              <tr>
                <th class="px-3 py-2 text-left">Date</th>
                <th class="px-3 py-2 text-left">Title</th>
                <th class="px-3 py-2 text-left">Category</th>
                <th class="px-3 py-2 text-left">Amount</th>
                <th class="px-3 py-2 text-left">Actions</th>
              </tr>
            </thead>
            <tbody id="incomeTable">
              {% for entry in income_entries %}
                <tr>
                  <td class="px-3 py-2">{{ entry.date|date:"M d, Y" }}</td>
                  <td class="px-3 py-2">{{ entry.title }}</td>
                  <td class="px-3 py-2">{{ entry.category.name }}</td>
                  <td class="px-3 py-2 text-green-600">+ ₱{{ entry.amount }}</td>
                  <td class="px-3 py-2 whitespace-nowrap">
                    <!-- Edit: reload page with ?edit=<id>, preserving hash so modal opens -->
                    <a
                      href="?edit={{ entry.pk }}#dashboard"
                      class="text-blue-600 hover:underline"
                    >Edit</a>
                    <span class="px-1">|</span>
                    <!-- Delete: POST form to same view -->
                    <form method="post" class="inline">
                      {% csrf_token %}
                      <button
                        type="submit"
                        name="delete-entry"
                        value="{{ entry.pk }}"
                        class="text-red-600 hover:underline"
                        onclick="return confirm('Delete this entry?');"
                      >Delete</button>
                    </form>
                  </td>
                  
                </tr>
              {% empty %}
                <tr>
                  <td colspan="5" class="px-3 py-4 text-center text-gray-500">
                    No income entries found.
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
      

      
      <section id="expenses" class="page-content hidden">
        <header class="flex justify-between items-center mb-5">
          <h2 class="text-2xl font-bold">Expenses</h2>
          <div class="search">
            <input
              type="text"
              placeholder="Search expenses…"
              id="expenseSearch"
              class="w-full sm:w-72 px-4 py-2 border border-gray-300 rounded-lg"
            />
          </div>
        </header>
      
        <div class="overflow-x-auto bg-white rounded-lg shadow-md">
          <table class="table-auto w-full">
            <thead class="bg-gray-100">
              <tr>
                <th class="px-3 py-2 text-left">Date</th>
                <th class="px-3 py-2 text-left">Title</th>
                <th class="px-3 py-2 text-left">Category</th>
                <th class="px-3 py-2 text-left">Amount</th>
                <th class="px-3 py-2 text-left">Actions</th>
              </tr>
            </thead>
            <tbody id="expenseTable">
              {% for entry in expense_entries %}
                <tr>
                  <td class="px-3 py-2">{{ entry.date|date:"M d, Y" }}</td>
                  <td class="px-3 py-2">{{ entry.title }}</td>
                  <td class="px-3 py-2">{{ entry.category.name }}</td>
                  <td class="px-3 py-2 text-red-600">- ₱{{ entry.amount }}</td>
                  <td class="px-3 py-2 whitespace-nowrap">
                    <!-- Edit: reload page with ?edit=<id>, preserving hash so modal opens -->
                    <a
                      href="?edit={{ entry.pk }}#dashboard"
                      class="text-blue-600 hover:underline"
                    >Edit</a>
                    <span class="px-1">|</span>
                    <!-- Delete: POST form to same view -->
                    <form method="post" class="inline">
                      {% csrf_token %}
                      <button
                        type="submit"
                        name="delete-entry"
                        value="{{ entry.pk }}"
                        class="text-red-600 hover:underline"
                        onclick="return confirm('Delete this entry?');"
                      >Delete</button>
                    </form>
                  </td>
                  
                </tr>
              {% empty %}
                <tr>
                  <td colspan="5" class="px-3 py-4 text-center text-gray-500">
                    No expense entries found.
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
      

      <section id="categories" class="page-content {% if not register_form.errors %}hidden{% endif %}">
        <header class="flex justify-between items-center mb-5">
          <h2 class="text-2xl font-bold">Categories</h2>
          <form method="post" class="flex space-x-2">
            {% csrf_token %}
            <input
              type="text"
              name="name"
              placeholder="New category"
              class="w-full sm:w-72 px-4 py-2 border border-gray-300 rounded-lg"
            />
            <button
              type="submit"
              name="add-category"
              class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition"
            >
              Add
            </button>
          </form>
        </header>
      
        <ul class="list-disc pl-10 bg-white rounded-lg p-4 shadow-md mb-5">
          {% for cat in user_categories %}
            <li class="py-1">{{ cat.name }}</li>
          {% empty %}
            <li class="text-gray-500">No categories yet.</li>
          {% endfor %}
        </ul>
      </section>
      
      
      <section id="reports" class="page-content hidden">
        <header class="flex justify-between items-center mb-5">
          <h2 class="text-2xl font-bold">Reports</h2>
          <div class="search">
            <input
              type="text"
              placeholder="Search expenses…"
              class="w-full sm:w-72 px-4 py-2 border border-gray-300 rounded-lg"
            />
          </div>
        </header>

        <div
          class="project-summary overflow-hidden bg-white rounded-lg p-4 shadow-md w-full mb-5"
        >
          
        </div>
      </section>

      

      
      <div
        id="addEntryModal"
        class="fixed inset-0 hidden items-center justify-center bg-black bg-opacity-50 z-50"
      >
      <div class="bg-white rounded-lg shadow-lg w-full max-w-lg p-6 relative flex flex-col">
          
          <button
            id="closeModalBtn"
            class="absolute top-3 right-3 text-gray-500 hover:text-gray-700"
          >
            
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
          
          <h2 id="modalTitle" class="text-2xl font-bold mb-4">
            {% if is_edit %}Edit Entry{% else %}Add New Entry{% endif %}
          </h2>

          <form
          method="post"
          action="{% url 'budget:dashboard' %}"
          class="space-y-2 grid grid-cols-1 gap-4 w-full"
        >
          {% csrf_token %}
        
          {% if is_edit %}
            <input id="modalEntryId" type="hidden" name="entry-id" value="{{ edit_id }}">
          {% endif %}


          {# Non-field errors #}
          {% if entry_form.non_field_errors %}
            <div class="text-sm text-red-600">
              {% for err in entry_form.non_field_errors %}
                <p>{{ err }}</p>
              {% endfor %}
            </div>
          {% endif %}
        
          <!-- Title -->
          <div>
            <label for="{{ entry_form.title.id_for_label }}"
                   class="block text-sm font-medium text-gray-700">
              {{ entry_form.title.label }}
            </label>
            {{ entry_form.title }}
            {% if entry_form.title.errors %}
              <p class="text-sm text-red-600 mt-1">
                {{ entry_form.title.errors.0 }}
              </p>
            {% endif %}
          </div>
        
          <!-- Amount -->
          <div>
            <label for="{{ entry_form.amount.id_for_label }}"
                   class="block text-sm font-medium text-gray-700">
              {{ entry_form.amount.label }}
            </label>
            {{ entry_form.amount }}
            {% if entry_form.amount.errors %}
              <p class="text-sm text-red-600 mt-1">
                {{ entry_form.amount.errors.0 }}
              </p>
            {% endif %}
          </div>
        
          <!-- Date -->
          <div>
            <label for="{{ entry_form.date.id_for_label }}"
                   class="block text-sm font-medium text-gray-700">
              {{ entry_form.date.label }}
            </label>
            {{ entry_form.date }}
            {% if entry_form.date.errors %}
              <p class="text-sm text-red-600 mt-1">
                {{ entry_form.date.errors.0 }}
              </p>
            {% endif %}
          </div>
        
          <!-- Type -->
          <div id="modalTypeDiv" {% if is_edit %}class="hidden"{% endif %}>
            <label for="{{ entry_form.type.id_for_label }}"
                   class="block text-sm font-medium text-gray-700">
              {{ entry_form.type.label }}
            </label>
            {{ entry_form.type }}
            {% if entry_form.type.errors %}
              <p class="text-sm text-red-600 mt-1">
                {{ entry_form.type.errors.0 }}
              </p>
            {% endif %}
          </div>
        
          <!-- Category -->
          <div>
            <label for="{{ entry_form.category.id_for_label }}"
                   class="block text-sm font-medium text-gray-700">
              {{ entry_form.category.label }}
            </label>
            {{ entry_form.category }}
            {% if entry_form.category.errors %}
              <p class="text-sm text-red-600 mt-1">
                {{ entry_form.category.errors.0 }}
              </p>
            {% endif %}
          </div>
        
          <!-- Notes -->
          <div>
            <label for="{{ entry_form.notes.id_for_label }}"
                   class="block text-sm font-medium text-gray-700">
              {{ entry_form.notes.label }}
            </label>
            {{ entry_form.notes }}
            {% if entry_form.notes.errors %}
              <p class="text-sm text-red-600 mt-1">
                {{ entry_form.notes.errors.0 }}
              </p>
            {% endif %}
          </div>
        
          <!-- Actions -->
          <div class="flex justify-end space-x-2 pt-4">
            <button
              type="button"
              id="cancelEntryBtn"
              class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"
            >
              Cancel
            </button>
            <button
              id="modalSubmitBtn"
              type="submit"
              name="add-entry"
              class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700"
            >
              {% if is_edit %}Save Changes{% else %}Save{% endif %}
            </button>

          </div>
        </form>

          
        </div>
      </div>
      
    </main>

    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // ---- Sidebar tab switching ----
        const links = document.querySelectorAll('aside.sidebar nav a');
        const pages = document.querySelectorAll('.page-content');
        links.forEach(link => {
          link.addEventListener('click', e => {
            const targetId = link.getAttribute('href').slice(1);
            if (!targetId) return;
            e.preventDefault();
      
            links.forEach(a => a.classList.remove('active'));
            link.classList.add('active');
      
            pages.forEach(sec => sec.classList.toggle('hidden', sec.id !== targetId));
          });
        });
      
        // ---- User menu toggle ----
        const userBtn  = document.getElementById('userBtn');
        const userMenu = document.getElementById('userMenu');
        userBtn.addEventListener('click', e => {
          e.stopPropagation();
          userMenu.classList.toggle('hidden');
        });
        document.addEventListener('click', () => userMenu.classList.add('hidden'));
      
        // ---- Modal controls ----
        const addEntryBtn    = document.getElementById('addEntryBtn');
        const addEntryModal  = document.getElementById('addEntryModal');
        const closeModalBtn  = document.getElementById('closeModalBtn');
        const cancelEntryBtn = document.getElementById('cancelEntryBtn');
        const modalTitle     = document.getElementById('modalTitle');
        const modalSubmitBtn = document.getElementById('modalSubmitBtn');
        const modalTypeDiv   = document.getElementById('modalTypeDiv');
        const form           = document.querySelector('#addEntryModal form');
      
        function showModal() {
          addEntryModal.classList.remove('hidden');
          addEntryModal.classList.add('flex');
        }
        function hideModal() {
          addEntryModal.classList.add('hidden');
          addEntryModal.classList.remove('flex');
        }
      
        function cleanUrl() {
          history.replaceState(null, '', window.location.pathname + '');
        }
      
        function resetModalToAdd() {
          modalTitle.textContent     = 'Add New Entry';
          modalSubmitBtn.textContent = 'Save';
          modalTypeDiv.classList.remove('hidden');
          const eid = document.getElementById('modalEntryId');
          if (eid) eid.remove();
      
          form.querySelectorAll('input:not([type=hidden]), select, textarea')
            .forEach(el => {
              el.value = '';
              if (el.tagName.toLowerCase() === 'select') el.selectedIndex = 0;
            });
          form.querySelectorAll('.text-red-600').forEach(e => e.remove());
        }
      
        // Open Add mode
        addEntryBtn.addEventListener('click', e => {
          e.preventDefault();
          resetModalToAdd();
          showModal();
        });
      
        // Close modal and reset
        [closeModalBtn, cancelEntryBtn].forEach(btn =>
          btn.addEventListener('click', e => {
            e.preventDefault();
            hideModal();
            cleanUrl();
            resetModalToAdd();
          })
        );
        addEntryModal.addEventListener('click', e => {
          if (e.target === addEntryModal) {
            hideModal();
            cleanUrl();
            resetModalToAdd();
          }
        });
      
        // Auto-open for edit
        {% if is_edit or entry_form.errors %}
          showModal();
          cleanUrl();
        {% endif %}
      
        // ---- Table filtering ----
        function setupFilter(inputId, tableId) {
          const inp = document.getElementById(inputId);
          const tbl = document.getElementById(tableId);
          inp.addEventListener('input', () => {
            const q = inp.value.toLowerCase();
            tbl.querySelectorAll('tr').forEach(row => {
              row.style.display = row.textContent.toLowerCase().includes(q)
                                ? ''
                                : 'none';
            });
          });
        }
        setupFilter('incomeSearch','incomeTable');
        setupFilter('expenseSearch','expenseTable');
      });
      </script>
      


  </body>
</html>
