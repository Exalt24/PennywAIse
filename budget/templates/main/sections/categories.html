{% load static %}

<section id="categories" class="page-content hidden" role="region" aria-label="Category management">

  <!-- HEADER: align title & form at the top -->
  <header class="flex items-start justify-between mb-5 mt-6">
    <h2 class="pagetitle self-start">Categories</h2>

    <form
      method="post"
      class="grid grid-cols-1 sm:grid-cols-[1fr_auto] items-start gap-4"
      role="form"
      aria-labelledby="add-category-heading"
    >
      {% csrf_token %}
      <!-- Column 1: label + input stacked -->
      <div class="flex flex-col space-y-2">
        <label for="id_name" class="text-lg font-medium text-[#1B1F1E]">
          New category:
        </label>
        <input
          type="text"
          name="name"
          id="id_name"
          placeholder="e.g. Groceries"
          required
          class="border border-gray-300 rounded-lg px-4 py-2 w-full sm:w-48"
          aria-required="true"
        />
        {% if category_form.name.errors %}
          <div role="alert" class="text-sm text-red-600">
            {% for err in category_form.name.errors %}
              <p>{{ err }}</p>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Column 2: button stays at top -->
      <button
        type="submit"
        name="add-category"
        class="self-end px-10 py-2 bg-[#1B1F1E] hover:bg-[#3f3a36] text-white rounded-full transition focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#3f3a36]"
      >
        Add
      </button>
    </form>
  </header>

  {% with section_id="categories" aria_label="Category overview table" title="Overview" title_id="overview-heading" tbody_id="categoryTable" page_obj=page_obj_category page_param="cat_page" %}
      {% include "main/components/tables/category_table.html" %}
  {% endwith %}
  </section>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form       = document.querySelector('form[role="form"]');
    const button     = form.querySelector('button[name="add-category"]');
    const errorBox   = form.querySelector('[role="alert"]');

    function updateButtonMargin() {
      if (form.querySelector('[role="alert"]')) {
        button.classList.add('mb-[28px]');
      } else {
        button.classList.remove('mb-[28px]');
      }
    }

    // Run on load (for server-rendered errors)
    updateButtonMargin();

    // If you ever inject errors via JS, re-run:
    // e.g. after AJAX, call updateButtonMargin() again
  });
</script>
